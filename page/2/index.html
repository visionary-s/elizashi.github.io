<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    
    Solito</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  <script src="/js/pace.min.js"></script>
</head>
</html>
<body>
<main class="content">
  <section class="jumbotron">
  <div class="video">
    
      <div class="video-frame">
        <img src="https://res.cloudinary.com/elizashi/image/upload/v1564042232/gitblog/ocean/overlay-hero_hfo1px.png" alt="Decorative image frame">
      </div>
    
    <div class="video-media">
      <video playsinline="" autoplay="" loop="" muted="" data-autoplay=""
             poster="https://res.cloudinary.com/elizashi/image/upload/v1564042234/gitblog/ocean/ocean_dvmafj.png" x5-video-player-type="h5">
        <source src="https://res.cloudinary.com/elizashi/video/upload/v1564042238/gitblog/ocean/ocean_j5rpnt.mp4" type="video/mp4">
        <source src="https://res.cloudinary.com/elizashi/video/upload/v1564042232/gitblog/ocean/ocean_p4kg5c.ogv" type="video/ogg">
        <source src="https://res.cloudinary.com/elizashi/video/upload/v1564042238/gitblog/ocean/ocean_qgwvjh.webm" type="video/webm">
        <p>Your user agent does not support the HTML5 Video element.</p>
      </video>
      <div class="video-overlay"></div>
    </div>
    <div class="video-inner text-center text-white">
      <h1><a href="/">Solito</a></h1>
      <p>Buring silence in SHA.</p>
      <div><img src="/images/ming-inverted.svg" class="brand" alt="Solito"></div>
    </div>
    <div class="video-learn-more">
      <a class="anchor" href="#landingpage"><i class="fe fe-mouse"></i></a>
    </div>
  </div>
</section>

<div id="landingpage">
  <section class="outer">
  <article class="articles">
    
    <h1 class="page-type-title"></h1>

    
      
        <article id="post-postgres-error-linux" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/05/09/postgres-error-linux/">Failed starting postgres DB container via k8s on linux</a>
    </h2>
  


      </header>
    

    
      <div class="article-meta">
        <a href="/2020/05/09/postgres-error-linux/" class="article-date">
  <time datetime="2020-05-08T16:00:00.000Z" itemprop="datePublished">2020-05-09</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/work/">work</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>When starting a postgres DB container via kubernetes on linux host server, it failed to start the container.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@compute2 log]# kubectl get pod</span><br><span class="line">NAME                                                READY   STATUS    RESTARTS   AGE</span><br><span class="line">test-764dc8f84b-smg92                               0/1     Error     3          49s</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@compute2 log]# kubectl logs test-764dc8f84b-smg92</span><br><span class="line">The files belonging to this database system will be owned by user &quot;postgres&quot;.</span><br><span class="line">This user must also own the server process.</span><br><span class="line"></span><br><span class="line">The database cluster will be initialized with locale &quot;en_US.utf8&quot;.</span><br><span class="line">The default database encoding has accordingly been set to &quot;UTF8&quot;.</span><br><span class="line">The default text search configuration will be set to &quot;english&quot;.</span><br><span class="line"></span><br><span class="line">Data page checksums are disabled.</span><br><span class="line"></span><br><span class="line">fixing permissions on existing directory /var/lib/postgresql/data ... ok</span><br><span class="line">creating subdirectories ... ok</span><br><span class="line">selecting default max_connections ... 20</span><br><span class="line">selecting default shared_buffers ... 400kB</span><br><span class="line">selecting dynamic shared memory implementation ... posix</span><br><span class="line">creating configuration files ... ok</span><br><span class="line">child process was terminated by signal 7</span><br><span class="line">initdb: removing contents of data directory &quot;/var/lib/postgresql/data&quot;</span><br></pre></td></tr></table></figure>

<p>Image is with no problem cuz I can do <code>docker run</code> to start container successfully. <br>————————————— Solution ————————————— <br><a href="https://github.com/docker-library/postgres/issues/451" target="_blank" rel="noopener">https://github.com/docker-library/postgres/issues/451</a> <br>there are several possible solutions to the problem:</p>
<ol>
<li>Modify the docker image to be able to set huge_pages = off in /usr/share/postgresql/postgresql.conf.sample before initdb was ran (this is what I did).</li>
<li>Turn off huge page support on the system (vm.nr_hugepages = 0 in /etc/sysctl.conf).</li>
<li>Fix Postgres’s fallback mechanism when huge_pages = try is set (the default).</li>
<li>Modify the k8s manifest to enable huge page support (<a href="https://kubernetes.io/docs/tasks/manage-hugepages/scheduling-hugepages/" target="_blank" rel="noopener">https://kubernetes.io/docs/tasks/manage-hugepages/scheduling-hugepages/</a>).</li>
<li>Modify k8s to show that huge pages are not supported on the system, when they are not enabled for a specific container.</li>
</ol>
<p>I tried the second way, and solve the issue successfully.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://visionary-s.github.io/2020/05/09/postgres-error-linux/" data-id="ckcvsi81x0022u8hr3golgk0j"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/K8s/">K8s</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kubernetes/">Kubernetes</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/postgres/">postgres</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-k8s-errors" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/04/08/k8s-errors/">Errors encountered in using k8s</a>
    </h2>
  


      </header>
    

    
      <div class="article-meta">
        <a href="/2020/04/08/k8s-errors/" class="article-date">
  <time datetime="2020-04-07T16:00:00.000Z" itemprop="datePublished">2020-04-08</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/work/">work</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>This is a record in deploying k8s in work stage.</p>
<h2 id="Issue-1-failed-to-schedule-pod-for-not-running-“VolumeBinding”-filter-plugin"><a href="#Issue-1-failed-to-schedule-pod-for-not-running-“VolumeBinding”-filter-plugin" class="headerlink" title="Issue 1: failed to schedule pod for not running “VolumeBinding” filter plugin"></a>Issue 1: failed to schedule pod for not running “VolumeBinding” filter plugin</h2><p>describe pod:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Events:</span><br><span class="line">  Type     Reason            Age                 From               Message</span><br><span class="line">  ----     ------            ----                ----               -------</span><br><span class="line">  Warning  FailedScheduling  55s (x19 over 26m)  default-scheduler  error while running &quot;VolumeBinding&quot; filter plugin for pod &quot;eri-cec-9dcd4d6c8-whvrm&quot;: pod has unbound immediate PersistentVolumeClaims</span><br></pre></td></tr></table></figure>

<p>check pod specs by <code>kubectl edit pod &lt;pod-name&gt;</code>:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">cec-database</span></span><br><span class="line"><span class="attr">  persistentVolumeClaim:</span></span><br><span class="line"><span class="attr">    claimName:</span> <span class="string">eri-cec-database-pvc</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">cec-misc</span></span><br><span class="line"><span class="attr">  persistentVolumeClaim:</span></span><br><span class="line"><span class="attr">    claimName:</span> <span class="string">eri-cec-misc-pvc</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">default-token-pxxg8</span></span><br><span class="line"><span class="attr">  secret:</span></span><br><span class="line"><span class="attr">    defaultMode:</span> <span class="number">420</span></span><br><span class="line"><span class="attr">    secretName:</span> <span class="string">default-token-pxxg8</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line"><span class="attr">  conditions:</span></span><br><span class="line"><span class="attr">  - lastProbeTime:</span> <span class="literal">null</span></span><br><span class="line"><span class="attr">    lastTransitionTime:</span> <span class="string">"2020-04-08T01:58:02Z"</span></span><br><span class="line"><span class="attr">    message:</span> <span class="string">'error while running "VolumeBinding" filter plugin for pod "eri-cec-9dcd4d6c8-whvrm":</span></span><br><span class="line"><span class="string">      pod has unbound immediate PersistentVolumeClaims'</span></span><br><span class="line"><span class="attr">    reason:</span> <span class="string">Unschedulable</span></span><br><span class="line"><span class="attr">    status:</span> <span class="string">"False"</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">PodScheduled</span></span><br><span class="line"><span class="attr">  phase:</span> <span class="string">Pending</span></span><br><span class="line"><span class="attr">  qosClass:</span> <span class="string">BestEffort</span></span><br></pre></td></tr></table></figure>

<p>The two persistentVolumeClaims were set during <code>helm install</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">helm install -n eri ./cec-release-1.0.0.tgz \</span><br><span class="line">&gt; --set persistence.enabled=true \</span><br><span class="line">&gt; --set persistence.storageClass=nfs \</span><br><span class="line">&gt; --set persistence.database.size=5Gi \</span><br><span class="line">&gt; --set persistence.miscellaneous.size=5Gi \</span><br><span class="line">&gt; --set ingress.cecManager.hostName=dual-test \</span><br><span class="line">&gt; --set ingress.cecApi.hostName=dual-api</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">NAME:   eri</span><br><span class="line">LAST DEPLOYED: Wed Apr  8 09:58:00 2020</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: DEPLOYED</span><br><span class="line">======================================</span><br><span class="line">RESOURCES:</span><br><span class="line">==&gt; v1/Deployment</span><br><span class="line">NAME     AGE</span><br><span class="line">eri-cec  1s</span><br><span class="line">======================================</span><br><span class="line">==&gt; v1/PersistentVolumeClaim</span><br><span class="line">NAME                  AGE</span><br><span class="line">eri-cec-database-pvc  2s</span><br><span class="line">eri-cec-misc-pvc      2s</span><br><span class="line">======================================</span><br><span class="line">==&gt; v1/Pod(related)</span><br><span class="line">NAME                     AGE</span><br><span class="line">eri-cec-9dcd4d6c8-whvrm  1s</span><br><span class="line">======================================</span><br><span class="line">==&gt; v1/Secret</span><br><span class="line">NAME                     AGE</span><br><span class="line">eri-cec-database-secret  2s</span><br><span class="line">======================================</span><br><span class="line">==&gt; v1/Service</span><br><span class="line">NAME     AGE</span><br><span class="line">eri-cec  1s</span><br><span class="line">======================================</span><br><span class="line">==&gt; v1beta1/Ingress</span><br><span class="line">NAME             AGE</span><br><span class="line">eri-cec-ingress  1s</span><br></pre></td></tr></table></figure>

<p>=========================solution========================= <br>Refers:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/60774220/kubernetes-pod-has-unbound-immediate-persistentvolumeclaims" target="_blank" rel="noopener">https://stackoverflow.com/questions/60774220/kubernetes-pod-has-unbound-immediate-persistentvolumeclaims</a></li>
<li><a href="https://blog.csdn.net/oguro/article/details/96964440" target="_blank" rel="noopener">https://blog.csdn.net/oguro/article/details/96964440</a></li>
<li><a href="https://blog.csdn.net/liumiaocn/article/details/103388607" target="_blank" rel="noopener">https://blog.csdn.net/liumiaocn/article/details/103388607</a></li>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/" target="_blank" rel="noopener">https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/</a> <br>From above info, there is something wrong with PVC (PersistentVolumeClaims), which leaves state “unbound”. The PVC should be bound to certain PV (PersistentVolume) which has enough capacity to hold the binding PVC. <br>check PVCs and PVs:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@host63 cec-installer]# kubectl get pvc -A</span><br><span class="line">NAMESPACE   NAME                      STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">cec         eri-sh-cec-database-pvc   Pending                                      nfs            125m</span><br><span class="line">cec         eri-sh-cec-misc-pvc       Pending                                      nfs            125m</span><br><span class="line">default     eri-cec-database-pvc      Pending                                      nfs            3h22m</span><br><span class="line">default     eri-cec-misc-pvc          Pending                                      nfs            3h22m</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@host63 cec-installer]# kubectl get pv -A</span><br><span class="line">No resources found</span><br></pre></td></tr></table></figure>

<p>There is no PV on current node-63, thus I create two PVs for db-pvc and misc-pvc.<br>Make a directory for PVs first:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@host63 mnt]# sudo mkdir /mnt/data</span><br></pre></td></tr></table></figure>

<p>check permission and capacity the PVC need:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@host63 cec-installer]# kubectl edit pvc eri-sh-cec-database-pvc -n cec</span><br><span class="line">...</span><br><span class="line">accessModes:</span><br><span class="line">  - ReadWriteOnce</span><br><span class="line">resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 5Gi</span><br></pre></td></tr></table></figure>

<p>vi pv-init.yaml:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">eri-sh-cec-database-pv</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">eri-sh-cec-database-pv</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  nfs:</span></span><br><span class="line"><span class="attr">    path:</span> <span class="string">/mnt/data</span></span><br><span class="line"><span class="attr">    server:</span> <span class="string">nfs</span></span><br><span class="line"><span class="attr">  accessModes:</span> <span class="string">["ReadWriteMany","ReadWriteOnce"]</span></span><br><span class="line"><span class="attr">  capacity:</span></span><br><span class="line"><span class="attr">    storage:</span> <span class="number">5</span><span class="string">Gi</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">eri-sh-cec-misc-pv</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">eri-sh-cec-misc-pv</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  nfs:</span></span><br><span class="line"><span class="attr">    path:</span> <span class="string">/mnt/data</span></span><br><span class="line"><span class="attr">    server:</span> <span class="string">nfs</span></span><br><span class="line"><span class="attr">  accessModes:</span> <span class="string">["ReadWriteMany","ReadWriteOnce"]</span></span><br><span class="line"><span class="attr">  capacity:</span></span><br><span class="line"><span class="attr">    storage:</span> <span class="number">5</span><span class="string">Gi</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@host63 cec-installer]# kubectl apply -f pv-init.yaml</span><br><span class="line">persistentvolume/eri-sh-cec-database-pv created</span><br><span class="line">persistentvolume/eri-sh-cec-misc-pv created</span><br><span class="line">[root@host63 cec-installer]# kubectl get pv -A</span><br><span class="line">NAME                     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE</span><br><span class="line">eri-sh-cec-database-pv   5Gi        RWO,RWX        Retain           Available                                   15s</span><br><span class="line">eri-sh-cec-misc-pv       5Gi        RWO,RWX        Retain           Available                                   15s</span><br></pre></td></tr></table></figure>

<p>PVC still not work, check its status:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@host63 cec-installer]# kubectl describe pvc eri-sh-cec-database-pvc -n cec</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason                Age                   From                                                                                                                                Message</span><br><span class="line">  ----     ------                ----                  ----                                                                                                                                -------</span><br><span class="line">  Warning  ProvisioningFailed    54m (x3 over 104m)    cluster.local/nfs-provisioner-nfs-server-provisioner_nfs-provisioner-nfs-server-provisioner-0_79370fad-78b7-11ea-8b82-66556e93189d  failed to provision volume with StorageClass &quot;nfs&quot;: error getting NFS server IP for volume: service SERVICE_NAME=nfs-provisioner-nfs-server-provisioner is not valid; check that it has for ports map[&#123;111 UDP&#125;:true &#123;111 TCP&#125;:true &#123;2049 TCP&#125;:true &#123;20048 TCP&#125;:true] exactly one endpoint, this pod&apos;s IP POD_IP=192.168.220.144</span><br><span class="line">  Warning  ProvisioningFailed    38m (x8 over 3h6m)    cluster.local/nfs-provisioner-nfs-server-provisioner_nfs-provisioner-nfs-server-provisioner-0_79370fad-78b7-11ea-8b82-66556e93189d  failed to provision volume with StorageClass &quot;nfs&quot;: error getting NFS server IP for volume: service SERVICE_NAME=nfs-provisioner-nfs-server-provisioner is not valid; check that it has for ports map[&#123;2049 TCP&#125;:true &#123;20048 TCP&#125;:true &#123;111 UDP&#125;:true &#123;111 TCP&#125;:true] exactly one endpoint, this pod&apos;s IP POD_IP=192.168.220.144</span><br><span class="line">  Normal   Provisioning          21m (x16 over 3h6m)   cluster.local/nfs-provisioner-nfs-server-provisioner_nfs-provisioner-nfs-server-provisioner-0_79370fad-78b7-11ea-8b82-66556e93189d  External provisioner is provisioning volume for claim &quot;cec/eri-sh-cec-database-pvc&quot;</span><br><span class="line">  Warning  ProvisioningFailed    21m (x2 over 3h4m)    cluster.local/nfs-provisioner-nfs-server-provisioner_nfs-provisioner-nfs-server-provisioner-0_79370fad-78b7-11ea-8b82-66556e93189d  failed to provision volume with StorageClass &quot;nfs&quot;: error getting NFS server IP for volume: service SERVICE_NAME=nfs-provisioner-nfs-server-provisioner is not valid; check that it has for ports map[&#123;111 TCP&#125;:true &#123;2049 TCP&#125;:true &#123;20048 TCP&#125;:true &#123;111 UDP&#125;:true] exactly one endpoint, this pod&apos;s IP POD_IP=192.168.220.144</span><br><span class="line">  Normal   ExternalProvisioning  87s (x742 over 3h6m)  persistentvolume-controller                                                                                                         waiting for a volume to be created, either by external provisioner &quot;cluster.local/nfs-provisioner-nfs-server-provisioner&quot; or manually created by system administrator</span><br></pre></td></tr></table></figure>

<h2 id="Did-not-figure-out"><a href="#Did-not-figure-out" class="headerlink" title=" Did not figure out"></a> <strong>Did not figure out</strong></h2><hr>
<h2 id="Issue-2-The-deployed-pod-without-nfs-would-use-ipv4-as-default-and-service-nginx-ingress-will-use-ipv4-address-as-default-route-cannot-change-it"><a href="#Issue-2-The-deployed-pod-without-nfs-would-use-ipv4-as-default-and-service-nginx-ingress-will-use-ipv4-address-as-default-route-cannot-change-it" class="headerlink" title="Issue 2. The deployed pod (without nfs) would use ipv4 as default, and service nginx-ingress will use ipv4 address as default route, cannot change it."></a>Issue 2. The deployed pod (without nfs) would use ipv4 as default, and service <code>nginx-ingress</code> will use ipv4 address as default route, cannot change it.</h2><p>log nginx-ingress:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@host63 cec-installer]# kubectl logs nginx-ingress-controller-64d58897bd-b99gw</span><br><span class="line">  -------------------------------------------------------------------------------</span><br><span class="line">  NGINX Ingress controller</span><br><span class="line">    Release:       0.29.0</span><br><span class="line">    Build:         git-eedcdcdbf</span><br><span class="line">    Repository:    https://github.com/kubernetes/ingress-nginx</span><br><span class="line">    nginx version: nginx/1.17.8</span><br><span class="line">  -------------------------------------------------------------------------------</span><br><span class="line">  I0407 10:17:14.810155       8 flags.go:215] Watching for Ingress class: nginx</span><br><span class="line">  W0407 10:17:14.811042       8 flags.go:260] SSL certificate chain completion is disabled (--enable-ssl-chain-completion=false)</span><br><span class="line">  W0407 10:17:14.811123       8 client_config.go:543] Neither --kubeconfig nor --master was specified.  Using the inClusterConfig.  This might not work.</span><br><span class="line">  I0407 10:17:14.811367       8 main.go:193] Creating API client for https://192.167.0.1:443</span><br><span class="line">  I0407 10:17:14.820212       8 main.go:237] Running in Kubernetes cluster version v1.17 (v1.17.4) - git (clean) commit 8d8aa39598534325ad77120c120a22b3a990b5ea - platform linux/amd64</span><br><span class="line">  I0407 10:17:14.823302       8 main.go:91] Validated default/nginx-ingress-default-backend as the default backend.</span><br><span class="line">  I0407 10:17:15.126113       8 main.go:102] SSL fake certificate created /etc/ingress-controller/ssl/default-fake-certificate.pem</span><br><span class="line">  W0407 10:17:15.147723       8 store.go:657] Unexpected error reading configuration configmap: configmaps &quot;nginx-ingress-controller&quot; not found</span><br><span class="line">  I0407 10:17:15.156374       8 nginx.go:263] Starting NGINX Ingress controller</span><br><span class="line">  I0407 10:17:16.357204       8 nginx.go:307] Starting NGINX process</span><br><span class="line">  I0407 10:17:16.357338       8 leaderelection.go:242] attempting to acquire leader lease  default/ingress-controller-leader-nginx...</span><br><span class="line">  W0407 10:17:16.358186       8 controller.go:394] Service &quot;default/nginx-ingress-default-backend&quot; does not have any active Endpoint</span><br><span class="line">  I0407 10:17:16.358304       8 controller.go:137] Configuration changes detected, backend reload required.</span><br><span class="line">  I0407 10:17:16.360127       8 status.go:86] new leader elected: nginx-ingress-controller-64d58897bd-cthrs</span><br><span class="line">  I0407 10:17:16.450895       8 controller.go:153] Backend successfully reloaded.</span><br><span class="line">  I0407 10:17:16.450966       8 controller.go:162] Initial sync, sleeping for 1 second.</span><br><span class="line">  W0407 10:17:20.280746       8 controller.go:394] Service &quot;default/nginx-ingress-default-backend&quot; does not have any active Endpoint</span><br><span class="line">  W0407 10:17:23.614240       8 controller.go:394] Service &quot;default/nginx-ingress-default-backend&quot; does not have any active Endpoint</span><br><span class="line">  W0407 10:17:33.458971       8 controller.go:394] Service &quot;default/nginx-ingress-default-backend&quot; does not have any active Endpoint</span><br><span class="line">  I0407 10:17:53.811527       8 leaderelection.go:252] successfully acquired lease default/ingress-controller-leader-nginx</span><br><span class="line">  I0407 10:17:53.811566       8 status.go:86] new leader elected: nginx-ingress-controller-64d58897bd-b99gw</span><br><span class="line">  W0407 10:18:00.868971       8 controller.go:394] Service &quot;default/nginx-ingress-default-backend&quot; does not have any active Endpoint</span><br><span class="line">  I0408 03:14:30.743173       8 event.go:281] Event(v1.ObjectReference&#123;Kind:&quot;Ingress&quot;, Namespace:&quot;cec&quot;, Name:&quot;eri-sh-cec-ingress&quot;, UID:&quot;dd298fd3-3c16-42e8-a544-c7f942ec4e3e&quot;, APIVersion:&quot;networking.k8s.io/v1beta1&quot;, ResourceVersion:&quot;211359&quot;, FieldPath:&quot;&quot;&#125;): type: &apos;Normal&apos; reason: &apos;CREATE&apos; Ingress cec/eri-sh-cec-ingress</span><br><span class="line">  W0408 03:14:34.068588       8 controller.go:921] Service &quot;default/eri-cec&quot; does not have any active Endpoint.</span><br><span class="line">  W0408 03:14:34.068631       8 controller.go:921] Service &quot;default/eri-cec&quot; does not have any active Endpoint.</span><br><span class="line">  W0408 03:14:34.068648       8 controller.go:921] Service &quot;cec/eri-sh-cec&quot; does not have any active Endpoint.</span><br><span class="line">  W0408 03:14:34.068661       8 controller.go:921] Service &quot;cec/eri-sh-cec&quot; does not have any active Endpoint.</span><br><span class="line">  I0408 03:14:53.817883       8 status.go:274] updating Ingress cec/eri-sh-cec-ingress status from [] to [&#123;10.136.40.63 &#125;]</span><br><span class="line">  I0408 03:14:53.820045       8 event.go:281] Event(v1.ObjectReference&#123;Kind:&quot;Ingress&quot;, Namespace:&quot;cec&quot;, Name:&quot;eri-sh-cec-ingress&quot;, UID:&quot;dd298fd3-3c16-42e8-a544-c7f942ec4e3e&quot;, APIVersion:&quot;networking.k8s.io/v1beta1&quot;, ResourceVersion:&quot;211445&quot;, FieldPath:&quot;&quot;&#125;): type: &apos;Normal&apos; reason: &apos;UPDATE&apos; Ingress cec/eri-sh-cec-ingress</span><br><span class="line">  W0408 03:14:53.820285       8 controller.go:921] Service &quot;default/eri-cec&quot; does not have any active Endpoint.</span><br><span class="line">  W0408 03:14:53.820310       8 controller.go:921] Service &quot;default/eri-cec&quot; does not have any active Endpoint.</span><br><span class="line">  W0408 03:14:53.820326       8 controller.go:921] Service &quot;cec/eri-sh-cec&quot; does not have any active Endpoint.</span><br><span class="line">  W0408 03:14:53.820341       8 controller.go:921] Service &quot;cec/eri-sh-cec&quot; does not have any active Endpoint.</span><br></pre></td></tr></table></figure>

<p>Solved the problem of product service using default ipv4 as cluster-ip by adding new paras in helm deployment charts:</p>
<ul>
<li><p><code>ipFamily:</code> below <code>service:</code> in <code>values.yaml</code></p>
</li>
<li><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ipFamily:</span> <span class="string">&#123;&#123;.Values.service.ipFamily&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>below <code>spec:</code> in <code>service.yaml</code></p>
</li>
<li><p><code>--set service.ipFamily=IPv6</code> when helm install product</p>
</li>
</ul>
<p><strong>Solution:</strong><br>Modify helm chart before installing ingress, in <code>value.yaml</code>, config:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">reportNodeInternalIp:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">daemonset:</span></span><br><span class="line"><span class="attr">  useHostPort:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br></pre></td></tr></table></figure>

<p>you can also set service type and external_IP here.<br>After helm install, check if you can visit service using hostname via host-ip.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@host63 cec-installer]# curl http://dual-ipv6:80</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">[root@host63 cec-installer]# curl http://dual-ipv4:80</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>also check with client UI.</p>
<hr>
<hr>
<h2 id="Issue-3-Failed-to-init-tiller-pod-creating-error-rpc-error-code-DeadlineExceeded-desc-context-deadline-exceeded"><a href="#Issue-3-Failed-to-init-tiller-pod-creating-error-rpc-error-code-DeadlineExceeded-desc-context-deadline-exceeded" class="headerlink" title="Issue 3. Failed to init tiller, pod creating error: rpc error: code = DeadlineExceeded desc = context deadline exceeded"></a>Issue 3. Failed to init tiller, pod creating error: rpc error: code = DeadlineExceeded desc = context deadline exceeded</h2><p>pod hang on state <code>ContainerCreating</code> after doing helm init. describe pod:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@host59 ~]# kubectl describe -n kube-system pod tiller-deploy-969865475-sn2k2</span><br><span class="line">Name:           tiller-deploy-969865475-sn2k2</span><br><span class="line">Namespace:      kube-system</span><br><span class="line">Node:           host59/2001:1b74:88:9400::59:59</span><br><span class="line">Controlled By:  ReplicaSet/tiller-deploy-969865475</span><br><span class="line">Containers:</span><br><span class="line">  tiller:</span><br><span class="line">    Container ID:   </span><br><span class="line">    Image:          gcr.io/kubernetes-helm/tiller:v2.16.1</span><br><span class="line">    Image ID:       </span><br><span class="line">    Ports:          44134/TCP, 44135/TCP</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason                  Age                   From               Message</span><br><span class="line">  Normal   Scheduled               54m                   default-scheduler  Successfully assigned kube-system/tiller-deploy-969865475-sn2k2 to host59</span><br><span class="line">  Warning  FailedCreatePodSandBox  2m47s (x13 over 50m)  kubelet, host59    Failed to create pod sandbox: rpc error: code = DeadlineExceeded desc = context deadline exceeded</span><br><span class="line">  Normal   SandboxChanged          2m47s (x13 over 50m)  kubelet, host59    Pod sandbox changed, it will be killed and re-created.</span><br></pre></td></tr></table></figure>

<p>check docker containers, which is already running, so there must be something wrong with docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@host59 ~]# systemctl status kubelet -l</span><br><span class="line">Apr 17 17:25:27 host59 kubelet[19205]: E0417 17:25:27.660517   19205 dns.go:135] Nameserver limits were exceeded, some nameservers have been omitted, the applied nameserver line is: 10.221.16.11 10.221.16.10 150.236.34.180</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@host59 ~]# journalctl -u  kubelet -f</span><br><span class="line">Apr 17 17:27:18 host59 kubelet[19205]: E0417 17:27:18.262418   19205 cni.go:385] Error deleting kube-system_tiller-deploy-969865475-sn2k2/f35df2a630d07b0ec7149fb06d7216c60a3c77a7118924c7b7eb9556b02f5cab from network multus/multus-cni-network: netplugin failed with no error message</span><br><span class="line">Apr 17 17:27:18 host59 kubelet[19205]: W0417 17:27:18.263092   19205 cni.go:331] CNI failed to retrieve network namespace path: Error: No such container: beb6e83c61bc47ba808dcc51e6c76e89817efb1f518fe28bc1083c99ad4721e1</span><br><span class="line">Apr 17 17:27:19 host59 kubelet[19205]: E0417 17:27:19.660435   19205 dns.go:135] Nameserver limits were exceeded, some nameservers have been omitted, the applied nameserver line is: 10.221.16.11 10.221.16.10 150.236.34.180</span><br></pre></td></tr></table></figure>

<p>So the <code>multus</code> pod/container is not running correctly. Check the pod:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@host59 ~]# kubectl describe pod  -n kube-system pod kube-multus-ds-amd64-wz5xj</span><br><span class="line">Name:         kube-multus-ds-amd64-wz5xj</span><br><span class="line">Namespace:    kube-system</span><br><span class="line">Node:         host59/2001:1b74:88:9400::59:59</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason            Age                    From             Message</span><br><span class="line">  Warning  DNSConfigForming  117s (x291 over 6h7m)  kubelet, host59  Nameserver limits were exceeded, some nameservers have been omitted, the applied nameserver line is: 10.221.16.11 10.221.16.10 150.236.34.180</span><br><span class="line">Error from server (NotFound): pods &quot;pod&quot; not found</span><br></pre></td></tr></table></figure>

<p>Delete pod kube-mutlus:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f multus-daemonset.yml</span><br></pre></td></tr></table></figure>

<p>still not work, edit deployment find:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@host59 opt]# kubectl edit deploy tiller-deploy -n kube-system</span><br><span class="line">status:</span><br><span class="line">  conditions:</span><br><span class="line">  - lastTransitionTime: &quot;2020-04-20T01:53:55Z&quot;</span><br><span class="line">    lastUpdateTime: &quot;2020-04-20T01:53:55Z&quot;</span><br><span class="line">    message: Deployment does not have minimum availability.</span><br><span class="line">    reason: MinimumReplicasUnavailable</span><br><span class="line">    status: &quot;False&quot;</span><br><span class="line">    type: Available</span><br><span class="line">  - lastTransitionTime: &quot;2020-04-20T02:03:56Z&quot;</span><br><span class="line">    lastUpdateTime: &quot;2020-04-20T02:03:56Z&quot;</span><br><span class="line">    message: ReplicaSet &quot;tiller-deploy-b747845f&quot; has timed out progressing.</span><br><span class="line">    reason: ProgressDeadlineExceeded</span><br><span class="line">    status: &quot;False&quot;</span><br><span class="line">    type: Progressing</span><br><span class="line">  observedGeneration: 1</span><br><span class="line">  replicas: 1</span><br><span class="line">  unavailableReplicas: 1</span><br><span class="line">  updatedReplicas: 1</span><br></pre></td></tr></table></figure>

<p>Finally find the reason: mutlus is not compatible with calico, thus <code>Error deleting kube-system_tiller-deploy... from network multus/multus-cni-network: netplugin failed with no error message</code> happened as above. Even if I delete mutlus before, it has already been configured in etcd config file under /etc/kubernetes. So modify related config and the tiller pod will turn to normal.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://visionary-s.github.io/2020/04/08/k8s-errors/" data-id="ckcvsi880005su8hryobsqvsx"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/K8s/">K8s</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kubernetes/">Kubernetes</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-Kubernetes" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/04/07/Kubernetes/">K8s - kubectl</a>
    </h2>
  


      </header>
    

    
      <div class="article-meta">
        <a href="/2020/04/07/Kubernetes/" class="article-date">
  <time datetime="2020-04-06T16:00:00.000Z" itemprop="datePublished">2020-04-07</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/work/">work</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>Every time before start kubectl, remember export <code>admin.config</code> file first which contains server info for connection. The pwd should under path where the config file lies.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> KUBECONFIG=./admin.conf</span><br></pre></td></tr></table></figure>

<p>then start nodes</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get node</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get node -n testing</span><br></pre></td></tr></table></figure>

<center>
        
          <a class="article-more-link" href="/2020/04/07/Kubernetes/">Read More...</a>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://visionary-s.github.io/2020/04/07/Kubernetes/" data-id="ckcvsi80y0017u8hr9tkym9mv"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/K8s/">K8s</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kubernetes/">Kubernetes</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-k8s-ipv6-dualstack-support" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/03/20/k8s-ipv6-dualstack-support/">Support ipv6/dualStack in K8s</a>
    </h2>
  


      </header>
    

    
      <div class="article-meta">
        <a href="/2020/03/20/k8s-ipv6-dualstack-support/" class="article-date">
  <time datetime="2020-03-19T16:00:00.000Z" itemprop="datePublished">2020-03-20</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/work/">work</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p><strong>记录惊天巨坑enable ipv6 and dual stack for our product，从k8s安装开始</strong></p>
<p><em>0. 原来产品是本地安装测试的，仅支持ipv4安装很简便，但这次要求支持ipv6/dualStack，根据<a href="https://kubernetes.io/docs/concepts/services-networking/dual-stack/" target="_blank" rel="noopener">官网文档</a>，我们需要1.16版本以上的kubernetes，<code>kubectl version</code>查看本地版本:</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Client Version: version.Info&#123;Major:<span class="string">"1"</span>, Minor:<span class="string">"14"</span>, GitVersion:<span class="string">"v1.14.8"</span>, GitCommit:<span class="string">"211047e9a1922595eaa3a1127ed365e9299a6c23"</span>, GitTreeState:<span class="string">"clean"</span>, BuildDate:<span class="string">"2019-10-15T12:11:03Z"</span>, GoVersion:<span class="string">"go1.12.10"</span>, Compiler:<span class="string">"gc"</span>, Platform:<span class="string">"windows/amd64"</span>&#125;</span><br><span class="line">Server Version: version.Info&#123;Major:<span class="string">"1"</span>, Minor:<span class="string">"14"</span>, GitVersion:<span class="string">"v1.14.8"</span>, GitCommit:<span class="string">"211047e9a1922595eaa3a1127ed365e9299a6c23"</span>, GitTreeState:<span class="string">"clean"</span>, BuildDate:<span class="string">"2019-10-15T12:02:12Z"</span>, GoVersion:<span class="string">"go1.12.10"</span>, Compiler:<span class="string">"gc"</span>, Platform:<span class="string">"linux/amd64"</span>&#125;</span><br></pre></td></tr></table></figure>

<p><em>1.14。。赶紧查docker desktop自带的kubernetes怎么更新，发现<a href="https://monkeywie.github.io/2019/09/16/k8s-update-operate/" target="_blank" rel="noopener">要写deploy</a>测试或者<a href="https://www.cnblogs.com/lonelyxmas/p/10670477.html" target="_blank" rel="noopener">重装k8s?</a> 感觉不适用。因为这是docker自带的不知道重装会不会有别的影响。决定直接装到我们组的remote server上，这样测试也可以一步到位。</em></p>
<center>
        
          <a class="article-more-link" href="/2020/03/20/k8s-ipv6-dualstack-support/">Read More...</a>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://visionary-s.github.io/2020/03/20/k8s-ipv6-dualstack-support/" data-id="ckcvsi892005wu8hr4ai69xdh"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kubernetes/">Kubernetes</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/">k8s</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-shell" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/02/11/shell/">shell grammar</a>
    </h2>
  


      </header>
    

    
      <div class="article-meta">
        <a href="/2020/02/11/shell/" class="article-date">
  <time datetime="2020-02-10T16:00:00.000Z" itemprop="datePublished">2020-02-11</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/work/">work</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h3 id="gt-amp-gt-gt"><a href="#gt-amp-gt-gt" class="headerlink" title="&gt; &amp; &gt;&gt;"></a>&gt; &amp; &gt;&gt;</h3><ol>
<li><p><code>&gt;</code> 创建</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"hello shell"</span> &gt; output.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>&gt;&gt;</code> 追加</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"hello shell"</span> &gt;&gt; output.txt</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<p>当output.txt不存在时，两者都会创建一个新的output.txt；<br>当output.txt存在时，前者会清空并重新写入，后者怎会在末尾追加</p>
</blockquote>
<p>ref: <a href="https://blog.csdn.net/nahanai/article/details/83861449" target="_blank" rel="noopener">https://blog.csdn.net/nahanai/article/details/83861449</a></p>
<center>
        
          <a class="article-more-link" href="/2020/02/11/shell/">Read More...</a>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://visionary-s.github.io/2020/02/11/shell/" data-id="ckcvsi82n002nu8hr28t70bgc"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cmd/">cmd</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-docker" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/01/20/docker/">docker CMD for daily use</a>
    </h2>
  


      </header>
    

    
      <div class="article-meta">
        <a href="/2020/01/20/docker/" class="article-date">
  <time datetime="2020-01-19T16:00:00.000Z" itemprop="datePublished">2020-01-20</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/work/">work</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h3 id="images"><a href="#images" class="headerlink" title="images"></a>images</h3><ol>
<li><p>Display images on current server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker images</span><br></pre></td></tr></table></figure>
</li>
<li><p>rename image:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">oldName              latest              d583c3ac45fd        26 minutes ago      685.5 MB</span><br><span class="line">######## change to ########</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">newName            latest              d583c3ac45fd       26 minutes ago         685.5 MB</span><br></pre></td></tr></table></figure>

</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker image tag oldName:latest newName:latest</span><br><span class="line">or</span><br><span class="line">$ docker image tag d583c3ac45fd newName:latest</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Notice: this operation is equal to “copy” + “rename”, thus there will be two repositories “oldName” and “newName” after change. If you want to remove “oldName”, use <code>docker rmi oldName</code>.</p>
</blockquote>
<center>
        
          <a class="article-more-link" href="/2020/01/20/docker/">Read More...</a>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://visionary-s.github.io/2020/01/20/docker/" data-id="ckcvsi813001bu8hr3z80jkmb"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cmd/">cmd</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-create-react-app" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/01/19/create-react-app/">Tips for create-react-app</a>
    </h2>
  


      </header>
    

    
      <div class="article-meta">
        <a href="/2020/01/19/create-react-app/" class="article-date">
  <time datetime="2020-01-18T16:00:00.000Z" itemprop="datePublished">2020-01-19</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/interest/">interest</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>This is a recording work while using create-react-app.</p>
<h3 id="ERROR-SKIP-PREFLIGHT-CHECK-true"><a href="#ERROR-SKIP-PREFLIGHT-CHECK-true" class="headerlink" title="[ERROR] SKIP_PREFLIGHT_CHECK=true"></a>[ERROR] SKIP_PREFLIGHT_CHECK=true</h3><p>error happens when run <code>npm start</code>:<br><img src="https://res.cloudinary.com/elizashi/image/upload/v1579140501/gitblog/posts/create-react-app/react-npm-start-error_fk5pfl.png" alt="Alt"></p>
<p><strong>Solution:</strong></p>
<ol>
<li>create a new file named <strong>.env</strong> in folder.</li>
<li>write cmd <code>SKIP_PREFLIGHT_CHECK=true</code> into the file, save and restart npm.</li>
</ol>
<center>
        
          <a class="article-more-link" href="/2020/01/19/create-react-app/">Read More...</a>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://visionary-s.github.io/2020/01/19/create-react-app/" data-id="ckcvsi81c001hu8hrqio7rwk1"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/framework/">framework</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-sequelize" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/01/19/sequelize/">Sequelize</a>
    </h2>
  


      </header>
    

    
      <div class="article-meta">
        <a href="/2020/01/19/sequelize/" class="article-date">
  <time datetime="2020-01-18T16:00:00.000Z" itemprop="datePublished">2020-01-19</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/basic/">basic</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>Sequelize 是一个基于 promise 的 Node.js ORM, 目前支持 Postgres, MySQL, SQLite 和 Microsoft SQL Server, 主要用来进行数据库和nodejs后端数据映射。<br>Docs: <a href="https://demopark.github.io/sequelize-docs-Zh-CN/" target="_blank" rel="noopener">Sequelize Docs 中文版</a>(不全)  |  <a href="https://sequelize.org/master/" target="_blank" rel="noopener">Official api docs</a></p>
<p>Here I only mark certain api I use most frequently.</p>
<h2 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h2><h3 id="definition"><a href="#definition" class="headerlink" title="definition"></a>definition</h3><p>use <code>define</code> to map data model to table in db.<br><a name="dataModel"></a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">sequelize, DataTypes</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> Cell = sequelize.define(<span class="string">"Cell"</span>,</span><br><span class="line">        &#123;</span><br><span class="line">            id: &#123;</span><br><span class="line">                type: DataTypes.INTEGER,</span><br><span class="line">                primaryKey: <span class="literal">true</span>,</span><br><span class="line">                autoIncrement: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            type: &#123;</span><br><span class="line">                type: DataTypes.INTEGER,</span><br><span class="line">                defaultValue:<span class="number">1</span></span><br><span class="line">            &#125;,</span><br><span class="line">            name: &#123;</span><br><span class="line">                type: DataTypes.STRING(<span class="number">255</span>),</span><br><span class="line">                unique: <span class="string">'compositeIndex'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            ...</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            timestamps: <span class="literal">false</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    Cell.getCells = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...function...</span><br><span class="line"></span><br><span class="line">    ...function...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<center>
        
          <a class="article-more-link" href="/2020/01/19/sequelize/">Read More...</a>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://visionary-s.github.io/2020/01/19/sequelize/" data-id="ckcvsi82x002xu8hr0ad5w5zu"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/backend/">backend</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/database/">database</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-js-getter" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/01/08/js-getter/">JS getter</a>
    </h2>
  


      </header>
    

    
      <div class="article-meta">
        <a href="/2020/01/08/js-getter/" class="article-date">
  <time datetime="2020-01-07T16:00:00.000Z" itemprop="datePublished">2020-01-08</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/basic/">basic</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>Encountered with the following function as below:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">get</span> userFilter() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        dataset1: &#123;</span><br><span class="line">            value: <span class="string">'...'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        dataset2: &#123;</span><br><span class="line">            value: <span class="string">'...'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>so question comes up: <a href="https://stackoverflow.com/questions/42884751/whats-the-meaning-of-static-get-in-javascript-es6" target="_blank" rel="noopener">Whats the meaning of ‘static get’ in Javascript (ES6)?</a></p>
<center>
        
          <a class="article-more-link" href="/2020/01/08/js-getter/">Read More...</a>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://visionary-s.github.io/2020/01/08/js-getter/" data-id="ckcvsi81k001pu8hrv2ukubz0"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-mini-program" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/01/07/mini-program/">Mini-program project demo for starter</a>
    </h2>
  


      </header>
    

    
      <div class="article-meta">
        <a href="/2020/01/07/mini-program/" class="article-date">
  <time datetime="2020-01-06T16:00:00.000Z" itemprop="datePublished">2020-01-07</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/interest/">interest</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h3 id="demo-program"><a href="#demo-program" class="headerlink" title="demo program"></a>demo program</h3><ol>
<li><p>我要圣诞帽<br><a href="https://github.com/jasscia/ChristmasHat" target="_blank" rel="noopener">https://github.com/jasscia/ChristmasHat</a> <br>图片编辑，存图</p>
</li>
<li><p>掌故<br><a href="https://github.com/Gesangs/PhoneStory" target="_blank" rel="noopener">https://github.com/Gesangs/PhoneStory</a> <br>新闻推送</p>
</li>
<li><p>简约睡眠Music<br><a href="https://github.com/shajinyang/BeautyAudio" target="_blank" rel="noopener">https://github.com/shajinyang/BeautyAudio</a> <br>音乐播放器</p>
</li>
<li><p>运势小程序<br><a href="https://github.com/panyefan/wxfortune" target="_blank" rel="noopener">https://github.com/panyefan/wxfortune</a> <br>测运势，存图</p>
</li>
<li><p>跑马灯，左侧菜单，抽屉层，加载动画<br><a href="https://github.com/youzouzou/wxapp" target="_blank" rel="noopener">https://github.com/youzouzou/wxapp</a> <br>小程序组件合集</p>
<center>
        
          <a class="article-more-link" href="/2020/01/07/mini-program/">Read More...</a>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://visionary-s.github.io/2020/01/07/mini-program/" data-id="ckcvsi81n001su8hr80xxuzh0"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mini-program/">mini-program</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/resource/">resource</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
  </article>
  

  
    <nav class="page-nav">
      
      <a class="extend prev" rel="prev" href="/">Prev page</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next page</a>
    </nav>
  
</section>
</div>

  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span> visitors</li>
  
</ul>

    </div>
    <ul class="list-inline">
      <li>&copy; 2020 B. Eliza Shi</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>

<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/ming.svg" alt="Solito"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">Home</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">Archives</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">Gallery</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">About</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>

<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
    <i class="fe fe-rocket"></i>
</div>
    </li>
    <!-- <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li> -->
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" href="https://github.com/visionary-s" title="GitHub">
        <i class="fe fe-github"></i>
      </a>
    </li>
  </ul>
</nav>

<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>

</aside>
<script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/snap.svg-min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>


  <script src="/fancybox/jquery.fancybox.min.js"></script>



  <script src="/js/search.js"></script>


<script src="/js/ocean.js"></script>

</body>
</html>